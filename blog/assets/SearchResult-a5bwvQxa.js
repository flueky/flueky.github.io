import{b8 as X,b9 as I,ba as Y,aP as D,as as x,aS as Z,aw as ee,bb as se,bc as te,bd as j,ay as M,b2 as ae,ar as le,be as re,bf as ue,bg as oe,aR as ne,bh as ie,bi as N,bj as t,bk as ce,bl as O,bm as ve,bn as he,bo as pe,bp as ye,bq as de,br as fe,bs as ge,bt as E,bu as T,bv as be,bw as Re}from"./app-EutA-j-t.js";const He=v=>{const d=X(),f=I(),C=Y(),l=D(0),R=x(()=>l.value>0),h=Z([]);return ee(()=>{const{search:p,terminate:S}=se(),g=te(o=>{const b=o.join(" "),{searchFilter:k=c=>c,splitWord:Q,suggestionsFilter:L,...y}=d.value;b?(l.value+=1,p(o.join(" "),f.value,y).then(c=>k(c,b,f.value,C.value)).then(c=>{l.value-=1,h.value=c}).catch(c=>{console.warn(c),l.value-=1,l.value||(h.value=[])})):h.value=[]},j.searchDelay-j.suggestDelay);M([v,f],([o])=>g(o),{immediate:!0}),ae(()=>{S()})}),{isSearching:R,results:h}},xe=le({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(v,{emit:d}){const f=re(),C=I(),l=ue(be),{enabled:R,addQueryHistory:h,queryHistory:p,removeQueryHistory:S}=ye(),{enabled:g,resultHistory:o,addResultHistory:b,removeResultHistory:k}=de(),Q=R||g,L=oe(v,"queries"),{results:y,isSearching:c}=He(L),a=ne({isQuery:!0,index:0}),n=D(0),i=D(0),A=x(()=>Q&&(p.value.length>0||o.value.length>0)),P=x(()=>y.value.length>0),q=x(()=>y.value[n.value]||null),U=()=>{const{isQuery:e,index:s}=a;s===0?(a.isQuery=!e,a.index=e?o.value.length-1:p.value.length-1):a.index=s-1},$=()=>{const{isQuery:e,index:s}=a;s===(e?p.value.length-1:o.value.length-1)?(a.isQuery=!e,a.index=0):a.index=s+1},V=()=>{n.value=n.value>0?n.value-1:y.value.length-1,i.value=q.value.contents.length-1},W=()=>{n.value=n.value<y.value.length-1?n.value+1:0,i.value=0},B=()=>{i.value<q.value.contents.length-1?i.value+=1:W()},_=()=>{i.value>0?i.value-=1:V()},w=e=>e.map(s=>Re(s)?s:t(s[0],s[1])),z=e=>{if(e.type==="customField"){const s=fe[e.index]||"$content",[r,m=""]=ge(s)?s[C.value].split("$content"):s.split("$content");return e.display.map(u=>t("div",w([r,...u,m])))}return e.display.map(s=>t("div",w(s)))},H=()=>{n.value=0,i.value=0,d("updateQuery",""),d("close")},G=()=>R?t("ul",{class:"search-pro-result-list"},t("li",{class:"search-pro-result-list-item"},[t("div",{class:"search-pro-result-title"},l.value.queryHistory),p.value.map((e,s)=>t("div",{class:["search-pro-result-item",{active:a.isQuery&&a.index===s}],onClick:()=>{d("updateQuery",e)}},[t(E,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},e),t("button",{class:"search-pro-remove-icon",innerHTML:T,onClick:r=>{r.preventDefault(),r.stopPropagation(),S(s)}})]))])):null,J=()=>g?t("ul",{class:"search-pro-result-list"},t("li",{class:"search-pro-result-list-item"},[t("div",{class:"search-pro-result-title"},l.value.resultHistory),o.value.map((e,s)=>t(O,{to:e.link,class:["search-pro-result-item",{active:!a.isQuery&&a.index===s}],onClick:()=>{H()}},()=>[t(E,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(r=>w(r)).flat())]),t("button",{class:"search-pro-remove-icon",innerHTML:T,onClick:r=>{r.preventDefault(),r.stopPropagation(),k(s)}})]))])):null;return ie("keydown",e=>{if(v.isFocusing){if(P.value){if(e.key==="ArrowUp")_();else if(e.key==="ArrowDown")B();else if(e.key==="Enter"){const s=q.value.contents[i.value];h(v.queries.join(" ")),b(s),f.push(N(s)),H()}}else if(g){if(e.key==="ArrowUp")U();else if(e.key==="ArrowDown")$();else if(e.key==="Enter"){const{index:s}=a;a.isQuery?(d("updateQuery",p.value[s]),e.preventDefault()):(f.push(o.value[s].link),H())}}}}),M([n,i],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["search-pro-result-wrapper",{empty:v.queries.length?!P.value:!A.value}],id:"search-pro-results"},v.queries.length?c.value?t(ce,{hint:l.value.searching}):P.value?t("ul",{class:"search-pro-result-list"},y.value.map(({title:e,contents:s},r)=>{const m=n.value===r;return t("li",{class:["search-pro-result-list-item",{active:m}]},[t("div",{class:"search-pro-result-title"},e||l.value.defaultTitle),s.map((u,K)=>{const F=m&&i.value===K;return t(O,{to:N(u),class:["search-pro-result-item",{active:F,"aria-selected":F}],onClick:()=>{h(v.queries.join(" ")),b(u),H()}},()=>[u.type==="text"?null:t(u.type==="title"?ve:u.type==="heading"?he:pe,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[u.type==="text"&&u.header?t("div",{class:"content-header"},u.header):null,t("div",z(u))])])})])})):l.value.emptyResult:Q?A.value?[G(),J()]:l.value.emptyHistory:l.value.emptyResult)}});export{xe as default};
